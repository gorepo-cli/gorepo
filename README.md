<div align="center">
    <picture>
        <img style="margin-bottom:0;" width="130" src="./assets/gorepo.png" alt="logo">
    </picture>
    <h1 align="center" >GOREPO</h1>
</div>

<p align="center">
    A CLI to manage my Go monorepos.
    <br/>
    (not kidding, it's just stuff I need for now, <br/>remember that when you complain)
</p>

# Philosophy

The CLI should:
- be dumb to use
- allow running all commands from anywhere, because having to cd is just annoying
- allow running CI/CD commands (test, lint, build, etc.) for all modules at once
- allow both flat and nested structures (but common, make it flat, as flat as the earth)
- be transparent to the user regarding what it does behind the hood

See more future philosophy in ROADMAP.md

# Disclaimer
- This is not nearly a v1, it provides only basic features
- You should commit before running any command to see exactly what you are doing
- I only test Linux for now, macOS is probably ok, Windows is probably not

# Structure of a command

```
gorepo [global options] <command> [command options]
```

# Pre-requisites

- go: to use the CLI, you need go (used to run go commands)
- git: to build the project, you need git (used to inject the version)

# Getting started

Gorepo is not yet available on any package manager. You will need to build it yourself:
- Clone/download the repository
- Run `make build` to create bin/gorepo
- Add the bin folder to your PATH
- As a result, you can now run `gorepo` from anywhere
- Change code, build, test from anywhere, repeat

Example on Linux:
```
vim ~/.bashrc

# add this:
export PATH="$PATH:/home/my_name/Repositories/gorepo-cli/bin"

# refresh the terminal
source ~/.bashrc
```

# Concepts

A **monorepo** is defined as a project with a `work.toml` file at the root. It is generated by `gorepo init`.
You should not nest monorepos (what's wrong with you?).

A **module** is defined as a folder containing a `module.toml` file. It will be generated by `gorepo add` but currently you have to create it manually (don't be a baby just do it...). It can be an empty file for now.
Technically modules can be nested, but you're weird if you do it...

You can have a `scripts` section in both `work.toml` and `module.toml` files. They can be ran with `gorepo run <script_name>` (see reference below).

# Reference

The reference documentation contains information that 
is relevant to the actual commited version. Future development should be in ROADMAP.md

## gorepo init

### Description

Initialize a new monorepo at the working directory

### Usage

```
gorepo init
```

### Behaviour

This command creates two primary files:
- `work.toml` at the work directory
- `go.work` file if the strategy is set as 'workspace' one does not exist yet. This runs `go work init` behind the hood

## gorepo list

### Description

List all modules of the monorepo

### Usage

```
gorepo list
```

### Behaviour

This command lists all modules in the monorepo, formally a module is a folder with a `module.toml` file in it.

## gorepo execute

### Description

Execute a script across targeted modules

### Usage

```
gorepo execute [--target] [--exclude] [--allow-missing] [script_name]
```

### Parameters

- `script_name`: the name of the script to execute
- `--target` (optional): comma-separated names of modules to target, examples: `--target=mod1,mod2`
- `--exclude` (optional): comma-separated names of modules to exclude
- `--allow-missing` (optional): allows the script to run even if some of the targets does not have the script

### Behaviour

This command runs all the scripts (bash scripts) defined in `work.toml` and `module.toml` files that are targeted.
By default, it will not run if one of the targeted module is missing the script.
Note it will run all or nothing. If one fails, it will not revert the operations that already ran.

## gorepo version

### Description

Print the version of the CLI

### Usage

```
gorepo version
```

## Contributing

Contributions are welcome, please open an issue or submit a pull request.

## License

This project is licensed under the MIT License.

# Releases

- v0.1.1: Initial release
  - implemented gorepo init
  - implemented gorepo list
  - implemented gorepo run
  - implemented gorepo version